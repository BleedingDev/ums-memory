# Phase 0 JS/MJS Runtime Inventory

## Scope

- Inventory source: tracked repository files (`git ls-files '*.js' '*.mjs'`) plus currently present dist executables.
- Companion machine-readable artifact: `docs/reports/phase0-js-mjs-runtime-inventory.json`.
- Determinism: all arrays/keys in JSON are pre-sorted and stable.

## JS/MJS Surface Counts

| Category | Count |
| --- | ---: |
| api (`apps/api/**`) | 9 |
| cli (`apps/cli/**`) | 4 |
| ums (`apps/ums/**`) | 1 |
| shared (`libs/shared/**`) | 9 |
| tests (`tests/**`) | 19 |
| scripts (`scripts/**`) | 3 |
| benchmarks (`benchmarks/**`) | 1 |
| docs (`docs/**`, JS/MJS only) | 0 |
| `.js` files | 9 |
| `.mjs` files | 37 |
| **Total JS/MJS files** | **46** |

## Runtime/Test/Script Entrypoints

- Runtime entrypoints (package scripts): `api -> apps/api/src/server.mjs`, `cli -> apps/cli/src/index.mjs`, `ums -> apps/ums/src/index.mjs`, `bench:api -> apps/api/bench/benchmark.mjs`, `bench:ums -> benchmarks/ums-latency-benchmark.mjs`.
- Test entrypoints:
  - Root: `test:api`, `test:sfe`, `test:ums`.
  - Shared package: `libs/shared/package.json -> test`.
- Script-file entrypoints invoked directly: `apps/api/bench/benchmark.mjs`, `benchmarks/ums-latency-benchmark.mjs`, `scripts/build-sfe-matrix.mjs`, `scripts/ingest-coding-history.mjs`, `scripts/validate-ingestion.mjs`.
- Root package scripts total: 24 (full sorted map captured in JSON), including benchmark wrappers (`bench`, `bench:api`, `bench:ums`).

## Compiled Binary Entrypoints

- Declared direct build outputs:
  - `build:sfe:single -> dist/ums`
  - `build:sfe:cli -> dist/ums-cli`
  - `build:sfe:api -> dist/ums-api`
- Matrix build defaults (`scripts/build-sfe-matrix.mjs`):
  - Targets: `bun-linux-x64`, `bun-windows-x64`
  - Default app: `single`
  - Default outputs: `dist/bun-linux-x64/ums`, `dist/bun-windows-x64/ums.exe`
- Observed current dist executables:
  - `dist/bun-linux-x64/ums`
  - `dist/bun-windows-x64/ums.exe`

## Migration Notes By Category

- api:
  - 9 files cover runtime, benchmark, and app-local tests.
  - Primary runtime/API server entrypoint is `apps/api/src/server.mjs`.
- cli:
  - 4 files cover runtime and app-local tests.
  - Primary CLI runtime entrypoint is `apps/cli/src/index.mjs`.
- ums:
  - Single runtime entrypoint `apps/ums/src/index.mjs`.
  - Also used by `build:sfe:single`.
- shared:
  - 9 files in `libs/shared/src`, all `.js`.
  - `libs/shared/package.json` has a test script but no runtime `bin/main/exports` entrypoint.
- tests:
  - 19 files under top-level `tests/**`, plus app-local tests under `apps/api/test` and `apps/cli/test`.
  - `test:ums` and `bench:ums` inject runtime module/export via environment variables.
- scripts:
  - 3 script modules in `scripts/**`.
  - 10 root package scripts call these script modules directly.
- docs:
  - No tracked `.js`/`.mjs` files under `docs/**`.
  - `docs/reports/**` stores JSON outputs generated by runtime scripts.

## Risk Hotspots (Factual)

- Mixed module extensions across runtime surface: app/runtime code is mostly `.mjs`, shared core is `.js`.
- `libs/shared/package.json` test glob points to `./tests/**/*.test.js`, but there is no tracked `libs/shared/tests` directory.
- Binary build outputs come from two patterns (direct `dist/*` and matrix `dist/<target>/*`), increasing path variance.
- `test:ums` and `bench:ums` depend on `UMS_IMPL_MODULE` and `UMS_IMPL_EXPORT` env wiring.
- `scripts/ingest-coding-history.mjs` and `scripts/validate-ingestion.mjs` import API internals directly.
- Current `dist` contains only matrix-style single-app executables (`ums`, `ums.exe`) plus sourcemaps, not all direct build outputs.
